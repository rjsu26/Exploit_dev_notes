# Exploit Development

------

## Exploit Writing tutorial part 1 : Stack Based Overflows [(link)](https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/)

### Theory

#### CPU general purpose registers (x86):

- **EAX** & **EDX** : Performing calculations. EAX stores return values from function calls. 
- **EBX **: General purpose
- **ECX** : Counter - used for iterations
- **ESP** : Stack pointer
- **EBP** : Base pointer
- **EIP** : Instruction pointer
- **ESI** : Source Index - location of input data
- **EDI** : Destination Index - location of where result is to be stored

#### Process Memory (for a Win32 environment)

- 32 bit 
- Address range : 0x00000000 - 0xFFFFFFFF
- User land : 0x00000000 - 0x7FFFFFFF
- Kernel land : 0x80000000 - 0xFFFFFFFF
- Used **Flat-memory model** : Entire memory space is linear, sequential and contiguous. 
- How stack overflow works:<img src="https://www.corelan.be/wp-content/uploads/2010/09/image_thumb25.png" alt="image" style="zoom:100%;" />
- Working of a stack during subroutine call : <img src="https://www.cs.yale.edu/flint/cs421/papers/x86-asm/stack-convention.png" alt="img" style="zoom: 50%;" /> ![img](https://eli.thegreenplace.net/images/2011/02/stackframe1.png)
- 



#### Debugger

- Intel x86 is little-endian : ABCD will be saved as DCBA i.e. 0x44434241.
- ***cdecl*** (arguments passed into stack) and ***fastcall***(1st two args in registers ECX and EDX, remaining in stack) calling conventions.
- **ADLR** : **Ad**dress space **L**ayout **R**egister

#### Overwriting RET and forming a parameter

- code : <img src="/home/raj/.config/Typora/typora-user-images/image-20210627015039341.png" alt="image-20210627015039341" style="zoom: 50%;" />

-  Stack frame : <img src="/home/raj/.config/Typora/typora-user-images/image-20210627015204667.png" alt="image-20210627015204667" style="zoom:50%;" />

- Exploit : 

  ```bash
  python -c "print('a'*18 + '\x2d\x62\x55\x56' + 'a'*4 + '\x78\x56\x34\x12')" | ./or2
  ```

#### Return to multiple functions in a chain

- Putting return addresses of all functions to be executed sequentially. ![image-20210627024759094](/home/raj/.config/Typora/typora-user-images/image-20210627024759094.png)

#### First Shellcode 

- execve("/bin/sh")

- ![image-20210627140041638](/home/raj/.config/Typora/typora-user-images/image-20210627140041638.png)

- %eax=11[^1]; execve("/bin/sh", 0, 0)

  [^1]:11 denotes function execve(). Similarly 1 denotes exit()

- In bash : */bin/sh* **same as** *////bin/////////////////sh*

